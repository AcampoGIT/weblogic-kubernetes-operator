setup

  doublesync src122130 and devenv.sh
    (since we're going to use WLST to create the domain)

  mkdir -m 777 -p /scratch/k8s-dir
    (i.e. the parent directory for persistent volumes)

  make sure to get rid your old setup:
  (I had problems getting stuff to run until I got rid of this stuff)
    operator and domain namespaces
    persistent volumes
    cluster roles & cluster role bindings
    maybe /scratch/k8s_dir

poc source files

  domain-cm.yaml
    - create the config map for the domain that has the start/stop/probe scripts

  domain-home-pv.yaml & domain-home-pvc.yaml
    - create a pv for the domain home (stored under /scratch/k8s-dir/poc_duid/domain-home)
    - we're not going to need these once the domain home moves into the image

  domain-logs-pv.yaml & domain-logs-pvc.yaml
    - create a pv for the domain logs (stored under /scratch/k8s-dir/poc_duid/domain-logs)
    - we're still going to need these aonce the domain home moves into the image

  as-pod.yaml, ms1-pod.yaml, ms2-pod.yaml
    - create the server pods

  as-service.yaml, ms1-service.yaml, ms2-service.yaml
    - create the server services

  as-t3-service.yaml
    - create the admin server t3 channel service (haven't tried it yet)

  todo - all the load balancer yaml files

  pocenv.sh
    - all the names of the wls and k8s resources and persistent volume dirs live here
    - the yaml files MUST and env.sh MUST match
      (i.e. I didn't write a scripts to customize the yaml files to match env.sh)

  create-domain.sh
    runs:

      create-domain-home.sh
        uses WLST to create a domain directory, stored under ./poc-domain

      create-domain-pvs.sh
        creates the on-disk directories for the domain home and logs:
          /scratch/k8s-dir/poc_duid/domain-logs is an empty dir
          copies ./poc-domain to /scratch/k8s-dir/poc_duid/domain-home

      create-domain-resources.sh
        create a namespace for the domain (poc-d-ns)
        creates a secret w/ the domain admin credentials
        loads the yaml files to create the domain config map and the domain home and logs pvs & pvcs
        should be enhanced to wait for them to complete

x  delete-domain.sh - don't run this - run these instead:
x    runs:

      delete-domain-resources.sh
        removes the domain's namespace and pvs
        waits for the namespace to be deleted, but could time out

      delete-domain-pvs.sh
        removes the on-disk directories for the domain's volumes: /scratch/k8s-dir/poc_duid

  start-server.sh <servername> (e.g. as, ms1 or ms2)
    loads the yaml files to create the pod and service for the server and returns immediately

  stop-server.sh <servername>
    deletes the pod and service for the server and returns immediately

  server-log.sh <servername>
    print's the server's log to stdout

  server-nm-log.sh <servername>
    print's the nodemanager's log for that server to stdout

  server-nm-state.sh <servername>
    print the nodemanager's state file for that server

  server-pod-log.sh <servername>
    print the log for that server's pod

  server-pod-state.sh <servername>
    print the k8s status of the pod

  server-pod-desc.sh <servername>
    describe's the server's pod

# convert it to production mode
readDomain(domain_path)
cd('/')
cmo.setProductionModeEnabled(true)
updateDomain()
closeDomain()


cd('/NMProperties')
set('ListenAddress', '0.0.0.0')
set('ListenPort', 5556)
set('CrashRecoveryEnabled', 'true')
x set('NativeVersionEnabled', 'true')
set('StartScriptEnabled', 'false')
set('SecureListener', 'false')
set('LogLevel', 'FINEST')
set('DomainsDirRemoteSharingEnabled', 'true')
(compare w/ defaults ...)

../poc-domain/init-info/nodemanager-properties.xml
<?xml version="1.0" encoding="UTF-8"?>
<NMProperties xmlns="http://xmlns.oracle.com/cie/nodemanager/properties">
  <propertiesVersion>12.2.1</propertiesVersion>
.  <logLevel>FINEST</logLevel>
.  <secureListener>false</secureListener>
  <logFile>/domain-home/nodemanager/nodemanager.log</logFile>
.  <startScriptEnabled>false</startScriptEnabled>
.  <crashRecoveryEnabled>true</crashRecoveryEnabled>
  <domainsFile>/domain-home/nodemanager/nodemanager.domains</domainsFile>
  <nodeManagerHome>/domain-home/nodemanager</nodeManagerHome>
  <javaHome>/usr/java/jdk1.8.0_151</javaHome>
  <startScriptName>startWebLogic.sh</startScriptName>
.  <listenAddress>0.0.0.0</listenAddress>
.  <listenPort>5556</listenPort>
.  <domainsDirRemoteSharingEnabled>true</domainsDirRemoteSharingEnabled>
</NMProperties>

cd('/NMProperties')
set('ListenAddress', '0.0.0.0')
set('ListenPort', 5556)
set('CrashRecoveryEnabled', 'true')
n y set('NativeVersionEnabled', 'true')
set('StartScriptEnabled', 'false')
set('SecureListener', 'false')
set('LogLevel', 'FINEST')
set('DomainsDirRemoteSharingEnabled', 'true')
(compare w/ defaults ...)


../poc-domain/nodemanager/nodemanager.properties
#Node manager properties
#Sat Jun 02 10:45:25 EDT 2018
DomainsFile=/domain-home/nodemanager/nodemanager.domains
LogLimit=0
. DomainsDirRemoteSharingEnabled=true
PropertiesVersion=12.2.1
AuthenticationEnabled=true
NodeManagerHome=/domain-home/nodemanager
JavaHome=/usr/java/jdk1.8.0_151
. LogLevel=FINEST
DomainsFileEnabled=true
. ListenAddress=0.0.0.0
. NativeVersionEnabled=true
. ListenPort=5556
LogToStderr=true
weblogic.StartScriptName=startWebLogic.sh
. SecureListener=false
LogCount=1
QuitEnabled=false
LogAppend=true
weblogic.StopScriptEnabled=false
StateCheckInterval=500
. CrashRecoveryEnabled=true
. weblogic.StartScriptEnabled=false
LogFile=/domain-home/nodemanager/nodemanager.log
LogFormatter=weblogic.nodemanager.server.LogFormatter
ListenBacklog=50

cd('/SecurityConfiguration/base_domain')
cmo.setNodeManagerUsername(admin_username)
cmo.setNodeManagerPasswordEncrypted(admin_password)

config.xml
    <node-manager-username>weblogic</node-manager-username>
    <node-manager-password-encrypted>{AES}NdekHlPr1vdT9QROjLtuzj/YM2G+2p4RfCFA/FaXHW4=</node-manager-password-encrypted>
  </security-configuration>
